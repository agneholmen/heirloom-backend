{% extends "base.html" %}

{% block title %}{{ person.get_name_years }}{% endblock title %}

{% block content %}
    <div class="float-end">
        <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Edit</button>
        <ul class="dropdown-menu">
            <li>
                <a href="#" class="dropdown-item" hx-get="{% url 'edit_person' person.id %}" hx-target="#modal-content" 
                    type="button" hx-trigger="click" data-bs-toggle="modal" data-bs-target="#modal" 
                    hx-swap="innerHTML">Quick Edit</a>
            </li>
            <li><a href="#" class="dropdown-item" hx-get="{% url 'edit_relationships' person.id %}" hx-target="#modal-content"
                    type="button" hx-trigger="click" data-bs-toggle="modal" data-bs-target="#modal"
                    hx-swap="innerHTML">Edit Relationships</a></li>
        </ul>
        <button class="btn btn-success" type="button" data-bs-toggle="modal" data-bs-target="#modal" 
            hx-get="{% url 'event_list' person.id %}" hx-trigger="click" hx-swap="innerHTML" hx-target="#modal-content">Add Life Event</button>
        <button class="btn btn-danger" type="button" disabled>Delete Person</button>
        <button class="btn btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Add Person</button>
        <ul class="dropdown-menu">
            <li><a href="#" class="dropdown-item" hx-get="{% url 'add_person_as_child' person.id %}"
                hx-target="#modal-content" hx-trigger="click" hx-swap="innerHTML" data-bs-toggle="modal"
                data-bs-target="#modal">Child</a></li>
            <li><a href="#" class="dropdown-item" hx-get="{% url 'add_person_as_partner' person.id %}" 
                hx-target="#modal-content" hx-trigger="click" hx-swap="innerHTML" data-bs-toggle="modal"
                data-bs-target="#modal">Partner</a></li>
            {% if father %}
                <li><a href="#" class="dropdown-item disabled" aria-disabled="true">Father</a></li>
            {% else %}
                <li><a href="#" class="dropdown-item" hx-get="{% url 'add_person_as_parent' person.id 'father' %}" 
                    hx-target="#modal-content" hx-trigger="click" hx-swap="innerHTML" data-bs-toggle="modal"
                    data-bs-target="#modal">Father</a></li>
            {% endif %}
            {% if mother %}
                <li><a href="#" class="dropdown-item disabled" aria-disabled="true">Mother</a></li>
            {% else %}
                <li><a href="#" class="dropdown-item" hx-get="{% url 'add_person_as_parent' person.id 'mother' %}" 
                    hx-target="#modal-content" hx-trigger="click" hx-swap="innerHTML" data-bs-toggle="modal"
                    data-bs-target="#modal">Mother</a></li>
            {% endif %}
        </ul>
    </div>
    <h1>{{ person }}</h1>
    <p>Name: {{ person|default_if_none:"" }}</p>
    <p>Birth: {{ birth.date|default_if_none:"" }} {{ birth.place|default_if_none:"" }}</p>
    <p>Death: {{ death.date|default_if_none:"" }} {{ death.place|default_if_none:"" }}</p>
    {% if person.death_cause %}
        <p>Death Cause: {{ person.death_cause }}</p>
    {% endif %}
    <h2>Parents</h2>
    <p>Father: {% if father %}<a href="{% url 'person' father.id %}">{{ father.get_name_years }}</a>{% else %}-{% endif %}</p>
    <p>Mother: {% if mother %}<a href="{% url 'person' mother.id %}">{{ mother.get_name_years }}</a>{% else %}-{% endif %}</p>
    <h2>Siblings</h2>
    {% if siblings %}
        <ul>
        {% for sibling in siblings %}
            <li><p><a href="{% url 'person' sibling.indi.id %}">{{ sibling.indi.get_name_years }}</a></p></li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No siblings</p>
    {% endif %}
    {% if half_siblings %}
        <h2>Half-siblings</h2>
        <ul>
        {% for half_sibling in half_siblings %}
            <li><p><a href="{% url 'person' half_sibling.indi.id %}">{{ half_sibling.indi.get_name_years }}</a></p></li>
        {% endfor %}
        </ul>
    {% endif %}
    {% if families %}
        <h2>Families</h2>
        {% for family in families %}
            <h3>Family {{forloop.counter }}</h3>
            <p>Partner: {% if family.partner %}<a href="{% url 'person' family.partner.id %}">{{ family.partner.get_name_years }}</a>{% else %}-{% endif %}</p>
            {% if family.children %}
                <p>Children:</p>
                <ul>
                {% for child in family.children %}
                    <li><p><a href="{% url 'person' child.indi.id %}">{{ child.indi.get_name_years }}</a></p></li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endfor %}
    {% endif %}
    {% include 'genealogy/modal_container.html' %}
{% endblock content %}