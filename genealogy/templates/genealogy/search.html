{% extends "base.html" %}

{% load crispy_forms_tags %}
{% load static %}

{% block title %}Search{% endblock title %}

{% block content %}
    <h1>Search</h1>
    {% if not trees %}
        <p>You currently have no uploaded trees.</p>
    {% else %}
        {% if people %}
            <p>
                <button onClick="toggleText()" class="btn btn-primary" type="button" id="hide-button" data-bs-toggle="collapse" data-bs-target="#search-fields" aria-controls="search-fields" aria-expanded="true">Show search fields</button>
            </p>
        {% endif %}
        <div class="collapse show" id="search-fields">
            <form method="get" id="search-form">
                {% crispy search_form %}
            </form>
        </div>
    {% endif %}
    {% if people %}
        <h3>Search results</h3>
        {% include 'genealogy/search_results_pagination.html' with page=people %}
        {% include 'genealogy/search_results.html' %}
        <p>Found {{ people.paginator.count }} results in total.</p>
        <p>Showing page {{ people.number }} of {{ people.paginator.num_pages }}.</p>  
        {% include 'genealogy/search_results_pagination.html' with page=people %}      
        <script>
            /*
            If there are search results, hide the search fields by default.
            */
            window.onload = function() {
                document.getElementById("search-fields").classList.remove('show');
            };
            
            /*
            If search fields are hidden, show "Show search fields", otherwise
            show "Hide search fields"
            */
            function toggleText() {
                var x = document.getElementById("hide-button");
                if (x.innerHTML === "Show search fields") {
                    x.innerHTML = "Hide search fields";
                } else {
                    x.innerHTML = "Show search fields";
                }
            }
        </script>
    {% elif people is not None %}
        <p>No results found.</p>
    {% endif %}
    {% include 'genealogy/delete_person_modal_container.html' %}
    <script>
        /*
        Code for searching when pressing enter if search form is active. 
        */
        var form = document.getElementById("search-form");
        form.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                form.submit();
            }
        });
    </script>
    <script src="{% static 'js/edit_person_modal.js' %}"></script>
    <script>
        function handleDeletePersonRequest(evt) {
            if(evt.detail.xhr.status == 204) {
                location.reload();
            }
        }
    </script>
{% endblock content %}

